<script type="text/javascript" src="http://maps.api.2gis.ru/1.0"></script>

<div class="main_form">
  <div class="main_form_preview right">
    <h4>Предпросмотр</h4>
    <%= f.object.description? ? RedCloth.new(f.object.description).to_html.html_safe : '' %>
  </div>

  <div class="main_form_edit">
    <h4>Редактирование</h4>
    <div>
      <%= f.input :title %>
      <%= f.input :description, :wrapper_html => {:class => ''}, :input_html => { :class => 'description' } %>
      <%= f.input :tag %>
      <%= yield :additional_fields %>
    </div>

    <div>
      <ul>
        <li><%= link_to 'Добавить постер', '#', :class => 'choose_file', :id => 'poster_wrapper', :params => "vfs_path=#{resource.vfs_path}" %></li>
        <li><%= f.hidden_field :poster_url, :input_html => { :id => 'poster_url' } %></li>
        <li><%= image_tag_for resource.poster_url, 290, 390 if resource.poster_url? %></li>
      </ul>
    </div>

    <div>
      <ul>
        <li><%= link_to 'Изображение для главной', '#', :class => 'choose_file', :id => 'image_wrapper', :params => "vfs_path=#{resource.vfs_path}" %></li>
        <li><%= f.hidden_field :image_url, :input_html => { :id => 'image_url' } %></li>
        <li><%= image_tag_for resource.image_url, 653, 363 if resource.image_url? %></li>
      </ul>
    </div>

    <%= f.hidden_field :vfs_path %>

    <% unless f.object.affiche_schedule.try :persisted? %>
      <%= field_set_tag "#{t('simple_form.fieldset.showings')}".html_safe do %>
        <%= f.simple_fields_for :showings %>
        <%= f.link_to_add t('add_showing'), :showings %>
      <% end %>
    <% end %>

    <% if f.object.new_record? || f.object.affiche_schedule || f.object.showings.empty? %>
      <div class="affiche_schedule">
        <%= field_set_tag "#{t('simple_form.fieldset.affiche_schedule')}".html_safe do %>
        <%= link_to 'Показать расписание', '#', :onClick => '$(this).next().slideToggle(); return false;' %>
        <% f.object.build_affiche_schedule unless f.object.affiche_schedule %>
        <%= f.simple_fields_for :affiche_schedule do |f| %>
          <div class="row-fluid">
            <%= f.input :starts_on,
                        :as => :string,
                        :input_html => { :class => 'span12', :value => f.object.starts_on ? f.object.starts_on : '' },
                        :wrapper_html => { :class => 'span2' } %>
            <%= f.input :ends_on,
                        :as => :string,
                        :input_html => { :class => 'span12', :value => f.object.ends_on ? f.object.ends_on : '' },
                        :wrapper_html => { :class => 'span2' } %>
            <%= f.input :starts_at,
                        :as => :string,
                        :input_html => { :class => 'span12', :value => f.object.starts_at ? l(f.object.starts_at, :format => '%H:%M') : '' },
                        :wrapper_html => { :class => 'span2' } %>
            <%= f.input :ends_at,
                        :as => :string,
                        :input_html => { :class => 'span12', :value => f.object.ends_at ? l(f.object.ends_at, :format => '%H:%M') : '' },
                        :wrapper_html => { :class => 'span2' } %>
          </div>

          <div class="row-fluid">
            <div class="span2">
              <%= f.input :organization_id, :as => :hidden, :input_html => { :class => 'autosuggest_target' } %>
              <%= f.input :latitude, :as => :hidden, :input_html => { :class => 'latitude', :value => f.object.get_latitude } %>
              <%= f.input :longitude, :as => :hidden, :input_html => { :class => 'longitude', :value => f.object.get_longitude } %>
              <%= f.input :place, :input_html => { :class => 'span12 autosuggest' } %>
              <%= link_to "Указать/показать координаты", '#', :class => 'choose_coordinate' %>
            </div>

              <%= f.input :hall, :input_html => { :class => 'span12' }, :wrapper_html => { :class => 'span2' } %>
              <%= f.input :price_min, :input_html => { :class => 'span12' }, :wrapper_html => { :class => 'span2' } %>
              <%= f.input :price_max, :input_html => { :class => 'span12' }, :wrapper_html => { :class => 'span2' } %>
          </div>

          <div>
            <%= f.input :holidays, :as => :check_boxes, :collection => Schedule.days_for_select %>
          </div>
          <%= f.link_to_remove t('remove_affiche_schedule'), :class => 'left' %>
        <% end %>
      <% end %>
      </div>
    <% end %>
  </div> <!--main_form_edit -->
</div> <!--main_form -->
